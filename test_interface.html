<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Topper.top - Content Browser</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #1a2a6c, #2c3e50);
        color: #fff;
        min-height: 100vh;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      header {
        text-align: center;
        margin-bottom: 30px;
      }
      h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }
      .subtitle {
        font-size: 1.2rem;
        color: #bbb;
        margin-bottom: 20px;
      }
      .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }
      .btn {
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 30px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: bold;
        transition: all 0.3s ease;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      }
      .btn:active {
        transform: translateY(1px);
      }
      .btn-secondary {
        background: linear-gradient(135deg, #4b6cb7, #182848);
      }
      .content-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-top: 20px;
      }
      .content-card {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(4px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .content-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
      }
      .content-title {
        font-size: 1.4rem;
        margin: 0 0 15px 0;
        color: #4fc3f7;
        font-weight: 600;
      }
      .content-description {
        color: #e0e0e0;
        margin: 15px 0;
        line-height: 1.6;
      }
      .content-source {
        display: block;
        color: #90caf9;
        font-size: 0.9rem;
        margin: 10px 0;
        text-decoration: none;
      }
      .content-source:hover {
        text-decoration: underline;
      }
      .content-source::before {
        content: "üîó ";
      }
      .content-score {
        display: inline-block;
        background: rgba(76, 175, 80, 0.2);
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.9rem;
        margin: 10px 0;
      }
      .content-buttons {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }
      .rating-btn {
        flex: 1;
        padding: 10px;
        border-radius: 8px;
        border: none;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .upvote {
        background: linear-gradient(135deg, #4caf50, #2e7d32);
        color: white;
      }
      .downvote {
        background: linear-gradient(135deg, #f44336, #c62828);
        color: white;
      }
      .share {
        background: linear-gradient(135deg, #2196f3, #1565c0);
        color: white;
      }
      .details {
        background: rgba(0, 0, 0, 0.2);
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
        font-size: 0.9rem;
      }
      .loading {
        text-align: center;
        padding: 40px;
        font-size: 1.2rem;
      }
      .error {
        background: rgba(244, 67, 54, 0.2);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        margin: 20px 0;
      }
      .tag {
        display: inline-block;
        background: rgba(33, 150, 243, 0.2);
        color: #81d4fa;
        padding: 3px 8px;
        border-radius: 15px;
        font-size: 0.8rem;
        margin: 5px 5px 5px 0;
      }
      footer {
        text-align: center;
        margin-top: 50px;
        padding-top: 20px;
        color: #aaa;
        font-size: 0.9rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Topper.top - Content Browser</h1>
        <p class="subtitle">Browse and rate content items from the database</p>
      </header>

      <div class="controls">
        <button class="btn" onclick="loadItems()">Load All Items</button>
        <button class="btn" onclick="loadItems(10)">Load 10 Items</button>
        <button class="btn" onclick="loadLeaderboard()">Top Rated</button>
        <button class="btn btn-secondary" onclick="loadRandomItem()">
          Random Item
        </button>
      </div>

      <div id="content-container">
        <div class="loading">Click a button above to load content items</div>
      </div>
    </div>

    <footer>
      <p>Topper.top - Universal Rating Platform | Content Rating System</p>
    </footer>

    <script>
      // Load all items
      async function loadItems(limit = null) {
        try {
          let url = "http://localhost:3000/api/items";
          if (limit) {
            url += `?limit=${limit}`;
          }

          document.getElementById("content-container").innerHTML =
            '<div class="loading">Loading items...</div>';

          const response = await fetch(url);
          const data = await response.json();

          if (data.items && data.items.length > 0) {
            displayItems(data.items);
          } else {
            document.getElementById("content-container").innerHTML =
              '<div class="error">No items found in the database</div>';
          }
        } catch (error) {
          document.getElementById(
            "content-container"
          ).innerHTML = `<div class="error">Error loading items: ${error.message}</div>`;
        }
      }

      // Load leaderboard
      async function loadLeaderboard() {
        try {
          document.getElementById("content-container").innerHTML =
            '<div class="loading">Loading top rated items...</div>';

          const response = await fetch(
            "http://localhost:3000/api/leaderboard?limit=10"
          );
          const data = await response.json();

          if (data.items && data.items.length > 0) {
            displayItems(data.items);
          } else {
            document.getElementById("content-container").innerHTML =
              '<div class="error">No items found in the database</div>';
          }
        } catch (error) {
          document.getElementById(
            "content-container"
          ).innerHTML = `<div class="error">Error loading leaderboard: ${error.message}</div>`;
        }
      }

      // Load random item
      async function loadRandomItem() {
        try {
          document.getElementById("content-container").innerHTML =
            '<div class="loading">Loading random item...</div>';

          const response = await fetch("http://localhost:3000/api/random");
          const data = await response.json();

          if (data.item) {
            displayItems([data.item]);
          } else {
            document.getElementById("content-container").innerHTML =
              '<div class="error">No random item found</div>';
          }
        } catch (error) {
          document.getElementById(
            "content-container"
          ).innerHTML = `<div class="error">Error loading random item: ${error.message}</div>`;
        }
      }

      // Display items in the content grid
      function displayItems(items) {
        if (!items || items.length === 0) {
          document.getElementById("content-container").innerHTML =
            '<div class="error">No items to display</div>';
          return;
        }

        let html = '<div class="content-grid">';

        items.forEach((item) => {
          html += `
                <div class="content-card" data-id="${item.id}">
                    <h3 class="content-title">${escapeHtml(
                      item.title || item.name || "Untitled"
                    )}</h3>

                    ${
                      item.description
                        ? `<p class="content-description">${escapeHtml(
                            item.description
                          )}</p>`
                        : ""
                    }

                    ${
                      item.url
                        ? `<a href="${escapeHtml(
                            item.url
                          )}" target="_blank" class="content-source">Source Link</a>`
                        : ""
                    }

                    ${
                      item.score !== undefined
                        ? `<div class="content-score">Score: ${item.score}</div>`
                        : ""
                    }

                    ${
                      item.tags && Array.isArray(item.tags)
                        ? `<div class="tags">${item.tags
                            .map(
                              (tag) =>
                                `<span class="tag">${escapeHtml(tag)}</span>`
                            )
                            .join("")}</div>`
                        : ""
                    }

                    <div class="content-buttons">
                        <button class="rating-btn upvote" onclick="rateItem('${
                          item.id
                        }', 1)">üëç Upvote</button>
                        <button class="rating-btn downvote" onclick="rateItem('${
                          item.id
                        }', -1)">üëé Downvote</button>
                        <button class="rating-btn share" onclick="shareItem('${
                          item.id
                        }')">üîó Share</button>
                    </div>

                    ${
                      Object.keys(item).filter(
                        (key) =>
                          ![
                            "id",
                            "title",
                            "description",
                            "url",
                            "score",
                            "tags",
                          ].includes(key)
                      ).length > 0
                        ? `<div class="details">
                        <strong>Additional Info:</strong><br>
                        ${Object.keys(item)
                          .filter(
                            (key) =>
                              ![
                                "id",
                                "title",
                                "description",
                                "url",
                                "score",
                                "tags",
                              ].includes(key)
                          )
                          .map(
                            (key) =>
                              `<strong>${key}:</strong> ${escapeHtml(
                                String(item[key])
                              )}<br>`
                          )
                          .join("")}
                    </div>`
                        : ""
                    }
                </div>
                `;
        });

        html += "</div>";
        document.getElementById("content-container").innerHTML = html;
      }

      // Rate an item
      async function rateItem(itemId, value) {
        try {
          const response = await fetch("http://localhost:3000/api/ratings", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              itemId: itemId,
              value: value,
            }),
          });

          const data = await response.json();

          if (data.error) {
            alert("Error rating item: " + data.error);
            return;
          }

          // Update score in the UI
          const card = document.querySelector(`[data-id="${itemId}"]`);
          if (card) {
            const scoreElement = card.querySelector(".content-score");
            if (scoreElement) {
              scoreElement.textContent = `Score: ${data.item.score}`;
            }
          }

          alert(
            `Successfully ${
              value === 1 ? "upvoted" : "downvoted"
            } the item! New score: ${data.item.score}`
          );
        } catch (error) {
          alert("Error rating item: " + error.message);
        }
      }

      // Share item
      function shareItem(itemId) {
        const itemUrl = `${window.location.origin}/api/items/${itemId}`;
        navigator.clipboard
          .writeText(itemUrl)
          .then(() => {
            alert("Item link copied to clipboard!");
          })
          .catch(() => {
            prompt("Copy this link:", itemUrl);
          });
      }

      // Helper function to escape HTML
      function escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      // Load example items when page loads
      window.onload = function () {
        setTimeout(loadItems, 500); // Add slight delay to let page load
      };
    </script>
  </body>
</html>
