# TOPPER.top — Версия 0.0.1

Добро пожаловать — это простой бэкенд-шаблон для TOPPER.top (Универсальная Рейтинговая Платформа).

Я создал минимальный сервер на Node + TypeScript с простыми демонстрационными эндпоинтами, линтингом/форматированием, тестами, скриптом для заполнения данных и настройкой Docker для разработки, чтобы вы могли быстро начать работу.

Если вы новичок в этом — читайте разделы ниже шаг за шагом. Если что-то непонятно, укажите номер строки или название раздела, и я объясню это подробнее.

---

## Что включено

- Минимальный сервер на чистом Node (`src/server.ts`) с эндпоинтами:
  - `GET /api/health` — проверка работоспособности
  - `GET /api/version` — читает `version.txt`
  - `GET /api/info` — простая JSON-информация (имя, версия, время работы)
  - Статическая демонстрационная страница по адресу `/docs`, обслуживаемая из `public/`
- Простая обертка для логгера (`src/logger.ts`)
- Демонстрационные данные и скрипт для заполнения (`data/*.json`, `scripts/seed.ts`)
- Инструменты для разработки: TypeScript, ESLint, Prettier, Vitest, Husky + lint-staged
- Шаблон рабочего процесса CI (`.github/workflows/ci.yml`) — линтинг, проверка форматирования, сборка, тестирование, аудит
- Docker для разработки: `docker/Dockerfile.dev` и `docker/docker-compose.yml`
- Базовые шаблоны CONTRIBUTING, CODE_OF_CONDUCT и CHANGELOG

---

## Текущая версия разработки: 0.0.1

> **Примечание**: В настоящее время мы работаем над версией 0.0.1. Только Олег Зай определяет, какую версию мы разрабатываем. Эта версия служит начальным этапом разработки.

---

## Предварительные требования (что вам нужно на компьютере)

- Node.js (LTS) — проект ожидает Node `>=18`.
- Git
- Терминал / командная строка
  Если у вас отсутствует что-либо из этого, сообщите мне, что именно, и я помогу вам установить.

---

## Быстрый старт — запуск локально (без Docker)

1. Установите зависимости:

```bash
npm install
```

2. Заполните демонстрационные данные (создает примеры файлов в `data/`):

```bash
npm run seed
```

3. Запустите сервер разработки (горячая перезагрузка включена):

```bash
npm run dev
```

4. Откройте это в вашем браузере:

- Работоспособность: `http://localhost:3000/api/health`
- Версия: `http://localhost:3000/api/version`
- Информация: `http://localhost:3000/api/info`
- Страница документации: `http://localhost:3000/docs`

---

## Полезные npm-скрипты (что делает каждый)

- `npm run dev` — запускает сервер с горячей перезагрузкой (автоматически перезапускается при изменениях).
- `npm run build` — компилирует TypeScript в JavaScript в `dist/`.
- `npm run start` — запускает скомпилированный код из `dist/`.
- `npm run lint` — запускает ESLint и автоматически исправляет некоторые проблемы.
- `npm run format` — запускает Prettier для форматирования файлов.
- `npm run test` — запускает модульные тесты с Vitest.
- `npm run seed` — генерирует демонстрационные JSON-данные в `data/`.
- `npm run clean` — удаляет `dist/`.
- `npm run prepare` — (используется git-хуками / husky).

Пример — запуск линтинга и тестов:

```bash
npm run lint
npm run test
```

---

## Docker (разработка)

Включена настройка Docker для разработки, чтобы вы могли запускать приложение в контейнере. Это необязательно, но полезно, если вы хотите иметь одинаковую среду на разных машинах.

Сборка и запуск с docker-compose (из папки `docker/`):

```bash
# из корня репозитория
docker compose -f docker/docker-compose.yml up --build
```

Это монтирует проект в контейнер, так что изменения кода на вашей машине видны без пересборки образа.

Примечание: настройка образа Docker для продакшена отложена — эта настройка Docker предназначена для локальной разработки.

---

## Тестирование

Включен простой пример теста с использованием Vitest (`tests/health.test.ts`). Он ожидает, что сервер разработки будет запущен на порту 3000 для проверки HTTP.
Запуск тестов:

```bash
npm test
```

Если вы хотите запускать тесты изолированно (без необходимости запускать сервер вручную), мы можем добавить вспомогательный инструмент для тестирования позже — скажите мне, и я его включу.

---

## Линтинг и форматирование (почему это полезно)

- ESLint помогает находить проблемы в коде или опасные шаблоны (он проверяет ваш код).
- Prettier форматирует код единообразно (исправляет пробелы, запятые, переносы строк).
- Husky + lint-staged запускают форматирование и исправления линтинга перед каждым коммитом, чтобы репозиторий оставался чистым.

Запустите их локально:

```bash
npm run lint
npm run format
```

---

## CI (GitHub Actions)

Репозиторий включает базовый рабочий процесс CI `.github/workflows/ci.yml`. При запросах на слияние (pull requests) и пушах в `main` он:

1. Устанавливает зависимости
2. Запускает ESLint
3. Запускает проверку Prettier
4. Собирает TypeScript
5. Запускает тесты
6. Запускает `npm audit` (для выявления известных уязвимостей)

Это помогает поддерживать чистоту репозитория и предотвращает слияние кода, который нарушает тесты или правила стиля.

---

## Секреты и конфигурация

Для локальной разработки используйте файл `.env` (этот файл игнорируется Git). НЕ коммитьте секреты или ключи API.

Если мы добавим шаги CI, которым нужны ключи (например, Sentry DSN или учетные данные реестра Docker), мы будем хранить их в секретах GitHub Actions — я задокументирую, какие имена секретов нужно добавить в описание PR, когда я его открою.

---

## Данные и заполнение

Демонстрационные данные находятся в `data/` и создаются с помощью `npm run seed`. Содержимое для заполнения включает:

- `users.json`
- `ratings.json`
- `items.json`
- `settings.json`

Это небольшие JSON-файлы, позволяющие запускать и тестировать приложение без базы данных. Позже мы можем заменить их на реальную БД (Postgres/SQLite) и инструменты миграции.

---

## Что я создам в репозитории (чтобы вы знали, чего ожидать)

- `package.json`, `tsconfig.json`, `.eslintrc.json`, `.prettierrc`, `.editorconfig`
- `src/server.ts`, `src/logger.ts`
- `scripts/seed.ts` и примеры файлов `data/*.json`
- Демонстрационная страница `public/docs.html`
- `tests/` с простым примером Vitest
- `docker/` dev Dockerfile + `docker-compose.yml`
- `.github/workflows/ci.yml`, `CONTRIBUTING.md`, `CODE_OF_CONDUCT.md`, `CHANGELOG.md`

---

## Контроль версий разработки

> **Версия разработки**: В настоящее время мы разрабатываем версию 0.0.1
> **Контроль версий**: Только Олег Зай определяет, какую версию мы разрабатываем
> **Полномочия по выпуску**: Только Олег Зай определяет, когда версия завершена и может быть выпущена

---

## Следующие шаги (что я могу сделать для вас)

- Создать ветку `setup/initial` с шаблоном и открыть PR — я могу сделать это сейчас.
- Или я могу показать вам любой сгенерированный файл (например, `package.json` или `src/server.ts`) и объяснить его построчно перед коммитом.
- Или мы можем настроить любую конфигурацию (например: отключить `npm audit` в CI или включить интеграцию Snyk).

Если вы готовы, чтобы я закоммитил шаблон и открыл PR, ответьте: `да, создать ветку` или просто `создать ветку`.
Если вы предпочитаете сначала проверить файлы, ответьте: `показать package.json` или `показать server.ts`, и я покажу и объясню их.
